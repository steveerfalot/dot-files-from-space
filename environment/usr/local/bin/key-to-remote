#!/usr/bin/env bash

# arg 1 : REQUIRED : name of the server, or ip address of the server
# arg 2 : REQUIRED : password of the root user on the server from arg 1
# arg 3 : optional : file name of the ssh key you wish to use in ~/.ssh/

BOX=$1
PW=$2
KEY_NAME=$3

if [ -z "$KEY_NAME" ];
then
  KEY_NAME="id_rsa.pub"
fi

if [ -z "$BOX" ] || [ -z "$PW" ];
then
  echo "Must pass argument for the QA box you wish to add your ssh key to, and the password for the root user"
  echo "USAGE: key-to-remote {my-server-name-or-ip} {password-of-root-user} <name-of-ssh-key>"
  exit
elif [ -z $(command -v sshpass) ];
then
  echo "You must have sshpass installed. You can solve this by running:"
  echo "sudo apt install sshpass"
  exit
elif [ ! -f ${HOME}/.ssh/${KEY_NAME} ];
then
  echo "You must have an ssh key in your $HOME/.ssh/ directory named $KEY_NAME"
  exit
fi

cat ~/.ssh/id_rsa.pub | sshpass -p "$PW" ssh root@${BOX} 'cat >> .ssh/authorized_keys'

echo "****************************************"
echo "*  Added your key to $BOX      *"
echo "****************************************"
